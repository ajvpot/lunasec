package process

import (
	"errors"

	md "github.com/JohannesKaufmann/html-to-markdown"
	goose "github.com/advancedlogic/GoOse"
	"github.com/rs/zerolog/log"
)

func formatContentAsMarkdown(input, nurl string) (content string, err error) {
	defer func() {
		if recover() != nil {
			log.Error().
				Str("nurl", nurl).
				Err(err).
				Msg("unable to format content")
			err = errors.New("unable to format content")
		}
	}()

	g := goose.New()

	// could panic
	gArticle, err := g.ExtractFromRawHTML(input, nurl)
	if err != nil {
		log.Error().
			Err(err).
			Msg("unable to parse html from input")
		return
	}

	converter := md.NewConverter("", true, nil)
	content = "# " + gArticle.Title + "\n\n" + converter.Convert(gArticle.TopNode)
	return
}
