package scrape

import (
	"encoding/json"
	"fmt"
	"os"
	"os/exec"
	"path/filepath"
)

type Result struct {
	// Define your JSON result struct here
}

func callPython(pythonFile string, argString string) (out string, err error) {
	absPath, err := filepath.Abs(os.Args[0])
	if err != nil {
		fmt.Println("Error getting absolute path:", err)
		return
	}
	pyPath := filepath.Dir(absPath)

	baseCmd := fmt.Sprintf("pipenv run python %s../../../../ml/python %s", pyPath, pythonFile)

	cmd := exec.Command(baseCmd, argString)

	bytesOut, err := cmd.Output()
	if err != nil {
		return
	}
	out = string(bytesOut)
	return
}

func CleanScrapedAdvisory(contents string, vulnDescription string) (out string, err error) {
	pythonFile := "./scrape_utils/clean_scraped_advisories"

	escapedContents, err := json.Marshal(contents)
	if err != nil {
		return
	}
	escapedDescription, err := json.Marshal(vulnDescription)
	if err != nil {
		return
	}
	argString := fmt.Sprintf("\"%s\" \"%s\"", escapedContents, escapedDescription)
	stringOutput, err := callPython(pythonFile, argString)
	return stringOutput, nil
}
