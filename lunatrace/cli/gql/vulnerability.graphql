fragment vulnerabilityFragment on vulnerability {
    id
    affected {
        package {
            name
            package_manager
        }
        affected_range_events {
            type
            event
            version
        }
        affected_versions {
            version
        }
    }
    equivalents {
        vulnerability {
            id
            source
            source_id
        }
    }
    references {
        id
        url
    }
    source
    source_id
}

query GetVulnerability($package_name: String!, $package_manager: package_manager!) {
    vulnerability(where: {affected: {package: {name: {_eq: $package_name}, package_manager: {_eq: $package_manager}}}}) {
        ...vulnerabilityFragment
    }
}

query GetVulnerabilityMetadata($id: uuid!) {
    vulnerability_by_pk(id: $id) {
        id
        source
        source_id
        references {
            url
        }
        details
    }
}
